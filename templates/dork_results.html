{% extends "base.html" %}

{% block title %}Dork Results - NOA SQL Scanner{% endblock %}

{% block content %}
<h1 class="mb-4"><i class="fas fa-list-ul"></i> Dork Search Results</h1>

<div class="card">
    <div class="card-header bg-success text-white">
        <h5 class="mb-0">
            <i class="fas fa-search"></i> Query: <code>{{ dork_query }}</code>
        </h5>
    </div>
    <div class="card-body">
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            Found <strong>{{ urls|length }}</strong> URLs. 
            You can now scan these URLs individually or use bulk scan.
        </div>

        {% if errors %}
        <div class="alert alert-warning">
            <h6><i class="fas fa-exclamation-triangle"></i> Search Issues:</h6>
            <ul class="mb-0">
                {% for error in errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        
        {% if urls %}
        <div class="mb-3">
            <button class="btn btn-primary" onclick="selectAll()">
                <i class="fas fa-check-double"></i> Select All
            </button>
            <button class="btn btn-secondary" onclick="deselectAll()">
                <i class="fas fa-times"></i> Deselect All
            </button>
            <button class="btn btn-success" onclick="scanSelected()">
                <i class="fas fa-play"></i> Scan Selected
            </button>
        </div>
        
        <div class="list-group">
            {% for url in urls %}
            <div class="list-group-item">
                <div class="form-check">
                    <input class="form-check-input url-checkbox" type="checkbox" value="{{ url }}" id="url-{{ loop.index }}">
                    <label class="form-check-label" for="url-{{ loop.index }}">
                        <a href="{{ url }}" target="_blank">{{ url }}</a>
                    </label>
                    <a href="{{ url_for('scan') }}?url={{ url|urlencode }}" class="btn btn-sm btn-primary float-end">
                        <i class="fas fa-search"></i> Scan
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i>
            No URLs found with this dork query. Try a different query or search engine.
        </div>
        {% endif %}
    </div>
</div>

<script>
    function selectAll() {
        document.querySelectorAll('.url-checkbox').forEach(cb => cb.checked = true);
    }
    
    function deselectAll() {
        document.querySelectorAll('.url-checkbox').forEach(cb => cb.checked = false);
    }
    
    function scanSelected() {
        const selected = Array.from(document.querySelectorAll('.url-checkbox:checked'))
            .map(cb => cb.value);
        
        if (selected.length === 0) {
            alert('Please select at least one URL to scan');
            return;
        }
        
        if (confirm(`Scan ${selected.length} URL(s)? This may take a while.`)) {
            // Implement bulk scan logic
            alert('Bulk scan feature coming soon!');
        }
    }
</script>
{% endblock %}
